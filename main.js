miro.onReady(() => {
  miro.initialize({
    extensionPoints: {
      bottomBar: {
        title: "Generate Card",
        svgIcon:
          '<defs><path d="M513.69 242.45C521.76 242.45 528.3 248.99 528.3 257.06C528.3 270.74 528.3 297.18 528.3 310.86C528.3 318.93 521.76 325.47 513.69 325.47C499.63 325.47 472.07 325.47 458.01 325.47C449.94 325.47 443.4 318.93 443.4 310.86C443.4 297.18 443.4 270.74 443.4 257.06C443.4 248.99 449.94 242.45 458.01 242.45C472.07 242.45 499.63 242.45 513.69 242.45Z" id="a2lfggXW9r"></path><linearGradient id="gradientbYzWEFFxY" gradientUnits="userSpaceOnUse" x1="485.85" y1="242.45" x2="485.85" y2="325.47"><stop style="stop-color: #c6ceff;stop-opacity: 0.62" offset="0%"></stop><stop style="stop-color: #93a4f8;stop-opacity: 0.64" offset="100%"></stop></linearGradient><path d="M510.7 244.34L510.72 244.34L510.75 244.35L510.78 244.35L510.8 244.36L510.83 244.37L510.85 244.37L510.87 244.38L510.9 244.39L510.92 244.4L510.94 244.41L510.97 244.43L510.99 244.44L511.01 244.45L511.03 244.47L511.05 244.48L511.07 244.5L511.09 244.52L511.11 244.53L511.12 244.55L511.14 244.57L511.16 244.59L511.17 244.61L511.19 244.63L511.2 244.65L511.21 244.67L511.22 244.7L511.24 244.72L511.25 244.74L511.26 244.77L511.26 244.79L511.27 244.82L511.28 244.84L511.28 244.87L511.29 244.89L511.29 244.92L511.3 244.95L511.3 244.97L511.3 245L511.3 258.21L524.35 258.21L524.37 258.21L524.4 258.21L524.43 258.21L524.45 258.22L524.48 258.22L524.5 258.23L524.53 258.23L524.55 258.24L524.58 258.25L524.6 258.26L524.62 258.27L524.65 258.28L524.67 258.29L524.69 258.31L524.71 258.32L524.73 258.34L524.75 258.35L524.77 258.37L524.79 258.38L524.81 258.4L524.83 258.42L524.84 258.44L524.86 258.46L524.87 258.48L524.89 258.5L524.9 258.52L524.92 258.54L524.93 258.56L524.94 258.59L524.95 258.61L524.96 258.63L524.97 258.66L524.97 258.68L524.98 258.71L524.99 258.73L524.99 258.76L525 258.79L525 258.81L525 258.84L525 258.87L525 269.43L525 269.46L525 269.49L525 269.51L524.99 269.54L524.99 269.57L524.98 269.59L524.97 269.62L524.97 269.64L524.96 269.67L524.95 269.69L524.94 269.71L524.93 269.74L524.92 269.76L524.9 269.78L524.89 269.8L524.87 269.82L524.86 269.84L524.84 269.86L524.83 269.88L524.81 269.9L524.79 269.92L524.77 269.94L524.75 269.95L524.73 269.97L524.71 269.98L524.69 270L524.67 270.01L524.65 270.02L524.62 270.03L524.6 270.04L524.58 270.05L524.55 270.06L524.53 270.07L524.5 270.08L524.48 270.08L524.45 270.09L524.43 270.09L524.4 270.09L524.37 270.09L524.35 270.09L511.3 270.09L511.3 283.3L511.3 283.33L511.3 283.36L511.29 283.38L511.29 283.41L511.28 283.43L511.28 283.46L511.27 283.49L511.26 283.51L511.26 283.53L511.25 283.56L511.24 283.58L511.22 283.61L511.21 283.63L511.2 283.65L511.19 283.67L511.17 283.69L511.16 283.71L511.14 283.73L511.12 283.75L511.11 283.77L511.09 283.79L511.07 283.8L511.05 283.82L511.03 283.83L511.01 283.85L510.99 283.86L510.97 283.88L510.94 283.89L510.92 283.9L510.9 283.91L510.87 283.92L510.85 283.93L510.83 283.94L510.8 283.94L510.78 283.95L510.75 283.95L510.72 283.96L510.7 283.96L510.67 283.96L510.64 283.96L500.2 283.96L500.18 283.96L500.15 283.96L500.12 283.96L500.1 283.95L500.07 283.95L500.05 283.94L500.02 283.94L500 283.93L499.97 283.92L499.95 283.91L499.93 283.9L499.9 283.89L499.88 283.88L499.86 283.86L499.84 283.85L499.82 283.83L499.8 283.82L499.78 283.8L499.76 283.79L499.74 283.77L499.73 283.75L499.71 283.73L499.69 283.71L499.68 283.69L499.66 283.67L499.65 283.65L499.64 283.63L499.62 283.61L499.61 283.58L499.6 283.56L499.59 283.53L499.59 283.51L499.58 283.49L499.57 283.46L499.57 283.43L499.56 283.41L499.56 283.38L499.55 283.36L499.55 283.33L499.55 283.3L499.55 270.09L486.5 270.09L486.47 270.09L486.45 270.09L486.42 270.09L486.4 270.09L486.37 270.08L486.34 270.08L486.32 270.07L486.3 270.06L486.27 270.05L486.25 270.04L486.22 270.03L486.2 270.02L486.18 270.01L486.16 270L486.14 269.98L486.12 269.97L486.1 269.95L486.08 269.94L486.06 269.92L486.04 269.9L486.02 269.88L486.01 269.86L485.99 269.84L485.98 269.82L485.96 269.8L485.95 269.78L485.93 269.76L485.92 269.74L485.91 269.71L485.9 269.69L485.89 269.67L485.88 269.64L485.87 269.62L485.87 269.59L485.86 269.57L485.86 269.54L485.85 269.51L485.85 269.49L485.85 269.46L485.85 269.43L485.85 258.87L485.85 258.84L485.85 258.81L485.85 258.79L485.86 258.76L485.86 258.73L485.87 258.71L485.87 258.68L485.88 258.66L485.89 258.63L485.9 258.61L485.91 258.59L485.92 258.56L485.93 258.54L485.95 258.52L485.96 258.5L485.98 258.48L485.99 258.46L486.01 258.44L486.02 258.42L486.04 258.4L486.06 258.38L486.08 258.37L486.1 258.35L486.12 258.34L486.14 258.32L486.16 258.31L486.18 258.29L486.2 258.28L486.22 258.27L486.25 258.26L486.27 258.25L486.3 258.24L486.32 258.23L486.34 258.23L486.37 258.22L486.4 258.22L486.42 258.21L486.45 258.21L486.47 258.21L486.5 258.21L499.55 258.21L499.55 245L499.55 244.97L499.55 244.95L499.56 244.92L499.56 244.89L499.57 244.87L499.57 244.84L499.58 244.82L499.59 244.79L499.59 244.77L499.6 244.74L499.61 244.72L499.62 244.7L499.64 244.67L499.65 244.65L499.66 244.63L499.68 244.61L499.69 244.59L499.71 244.57L499.73 244.55L499.74 244.53L499.76 244.52L499.78 244.5L499.8 244.48L499.82 244.47L499.84 244.45L499.86 244.44L499.88 244.43L499.9 244.41L499.93 244.4L499.95 244.39L499.97 244.38L500 244.37L500.02 244.37L500.05 244.36L500.07 244.35L500.1 244.35L500.12 244.34L500.15 244.34L500.18 244.34L500.2 244.34L510.64 244.34L510.67 244.34L510.7 244.34Z" id="c973C7hRVV"></path></defs><g><g><g><use xlink:href="#a2lfggXW9r" opacity="0.21" fill="url(#gradientbYzWEFFxY)"></use><g><use xlink:href="#a2lfggXW9r" opacity="0.21" fill-opacity="0" stroke="#2764b6" stroke-width="7" stroke-opacity="1"></use></g></g><g><use xlink:href="#c973C7hRVV" opacity="0.61" fill="#3874e8" fill-opacity="1"></use></g></g></g>',
        positionPriority: 1,
        onClick: async () => {
          // get selected widgets
          let selectedWidgets = await miro.board.selection.get();

          // if selection is empty, exit gracefully.
          if (selectedWidgets.length == 0) {
            miro.showNotification("Please select some shapes");
          } else {
            //prompt
                //show number of selected eligible widget
                    // check list
                    // delete original content
                    // include in a frame? (textfield to accept frame title)
            
            // create respective cards for selected widget
            let generatedCards = [];
            let x = 0;
            let y = 100.0;
            let verticalItemCount = 0;
            for (element of selectedWidgets) {
              let c = await miro.board.widgets.create({
                type: "card",
                title: element.plainText,
                x: x,
                y: y,
              });
              y = y + 100.0;
              verticalItemCount++;
              if (verticalItemCount >= 5) {
                x = x + 350.0;
                verticalItemCount = 0;
                y = 100;
              }
              generatedCards.push(c[0]);
            }
            let generatedCardsId = [];
            for(element of generatedCards){
              generatedCardsId.push(element.id);
            }
            // select the generated card to accomodate user's quick actions
            await miro.board.selection.selectWidgets(generatedCardsId);
            // zoom to the first card generated
            await miro.board.viewport.zoomToObject(generatedCards);
            // create a frame and put all the generated card inside frame, if user has prompted
          }
        },
      },
    },
  });
});
